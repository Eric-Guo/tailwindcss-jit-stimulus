<%= turbo_frame_tag :manufacturer_feedback_modal do %>
  <div
    data-controller="modal turbo-modal"
    data-modal-allow-background-close="false"
    data-modal-disable-backdrop="true"
    data-turbo-modal-auto-show-value="true"
    data-manufacturer-feedback-target="turboModal"
  >
    <div data-modal-target="container" class="animated fadeIn fixed inset-0 overflow-y-auto flex items-center justify-center hidden" style="z-index: 9999; background: rgba(0, 0, 0, .4);">
      <!-- Modal Inner Container -->
      <div
        class="overflow-hidden bg-white text-left rounded-2.5 select-none"
        style="width: 780px;"
      >
        <div class="relative h-10 flex justify-center items-center bg-black text-lg text-white">
          <span>供应商信息反馈</span>
          <button class="absolute right-5 top-3.5 w-3 h-3 text-white" type="button" data-action="click->turbo-modal#hide">
            <svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" fill="currentColor" viewBox="0 0 16 16">
              <path fill-rule="evenodd" d="M13.854 2.146a.5.5 0 0 1 0 .708l-11 11a.5.5 0 0 1-.708-.708l11-11a.5.5 0 0 1 .708 0Z"/>
              <path fill-rule="evenodd" d="M2.146 2.146a.5.5 0 0 0 0 .708l11 11a.5.5 0 0 0 .708-.708l-11-11a.5.5 0 0 0-.708 0Z"/>
            </svg>
          </button>
        </div>
        <div class="p-5">
          <%= form_tag feedback_manufacturer_path(manufacturer_id), method: :post, id: 'feedbackManufacturerForm', data: {
            action: 'submit->manufacturer-feedback#formSubmit'
          } do %>
            <div>
              <div><span class="text-red">*</span> 问题类型</div>
              <div class="mt-4 grid grid-cols-4 gap-2.5">
                <% question_types.each do |item| %>
                  <div class="flex items-start">
                    <input id="<%= "question_type#{item[:id]}" -%>" name="question_type_ids[]" value="<%= item[:id] -%>" type="checkbox" class="mt-1 focus:ring-gray-50 text-gray-600 border-gray-300">
                    <label for="<%= "question_type#{item[:id]}" -%>" class="text-gray-700 ml-2 mt-px"><%= item[:title] -%></label>
                  </div>
                <% end %>
              </div>
            </div>
            <div class="mt-8">
              <div><span class="text-red">*</span> 意见反馈</div>
              <div class="mt-4 w-full h-28">
                <textarea
                  name="description"
                  placeholder="请输入你的意见反馈"
                  class="w-full h-full border border-neutral-200 rounded focus:border-black focus:ring-black resize-none text-sm placeholder:text-neutral-300 transition-all duration-300"
                ></textarea>
              </div>
            </div>
            <div class="mt-8">
              <div>问题截图</div>
              <div class="mt-4 w-full h-28 relative">
                <img
                  class="w-full h-full object-cover object-top"
                  src=""
                  alt=""
                  data-manufacturer-feedback-target="screenshotCover"
                >
                <div
                  class="absolute top-0 left-0 w-full h-full bg-black bg-opacity-60 flex flex-col justify-center items-center cursor-pointer hidden"
                  data-manufacturer-feedback-target="screenshotSuccess"
                  data-action="click->manufacturer-feedback#openEditor"
                >
                  <img class="w-8 h-8 object-cover" src="<%= image_pack_path('static/images/edit-pop.png') %>" alt="">
                  <span class="text-white mt-2">内容标记成功</span>
                </div>
                <div
                  class="absolute top-0 left-0 w-full h-full bg-neutral-140 flex flex-col justify-center items-center"
                  data-manufacturer-feedback-target="screenshotLoading"
                >
                  <svg xmlns="http://www.w3.org/2000/svg" class="w-8 h-8 animate-spin text-white" fill="currentColor" class="bi bi-arrow-clockwise" viewBox="0 0 16 16">
                    <path fill-rule="evenodd" d="M8 3a5 5 0 1 0 4.546 2.914.5.5 0 0 1 .908-.417A6 6 0 1 1 8 2v1z"/>
                    <path d="M8 4.466V.534a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384L8.41 4.658A.25.25 0 0 1 8 4.466z"/>
                  </svg>
                  <span class="text-white mt-2">正在处理页面截图</span>
                </div>
              </div>
              <div
                class="fixed inset-0 flex flex-col justify-center items-center bg-black bg-opacity-60 animated fadeIn hidden"
                style="z-index: 9999;"
                data-manufacturer-feedback-target="screenshotEditorWrapper"
                data-controller="screenshot-editor"
              >
                <div class="relative overflow-auto" style="width: 80%; height: 80%;" data-screenshot-editor-target="wrapper">
                  <canvas
                    data-manufacturer-feedback-target="screenshotEditorCanvas"
                    data-screenshot-editor-target="canvas"
                  >
                    您的设备不支持canvas
                  </canvas>
                  <div
                    class="absolute p-2 flex items-center border border-dashed focus:border-solid text-red text-2xl hidden"
                    style="min-width: 100px; min-height: 32px;"
                    contenteditable="true"
                    data-screenshot-editor-target="textInput"
                    data-action="mousedown->screenshot-editor#activeTextInput keydown->screenshot-editor#confirmTextInput"
                  ></div>
                </div>
                <div class="mt-3 flex items-center gap-5 px-5 py-4 bg-white rounded-md">
                  <button class="text-2xl outline-none text-black hover:text-blue-600" type="button" data-action="click->screenshot-editor#drawRect" data-screenshot-editor-target="drawActionButton">
                    <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="currentColor">
                      <path d="M20 4v16H4V4h16m0-2H4a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2z"/>
                    </svg>
                  </button>
                  <button class="text-2xl outline-none text-black hover:text-blue-600" type="button" data-action="click->screenshot-editor#drawArrow" data-screenshot-editor-target="drawActionButton">
                    <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="currentColor">
                      <path fill-rule="evenodd" d="M19 3H9v2h8.59l-15 15L4 21.41l15-15V15h2V3h-2z"/>
                    </svg>
                  </button>
                  <button class="text-2xl outline-none text-black hover:text-blue-600" type="button" data-action="click->screenshot-editor#drawText" data-screenshot-editor-target="drawActionButton">
                    <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="currentColor">
                      <path d="M21 3H3v2h8v17h2V5h8V3z"/>
                    </svg>
                  </button>
                  <div style="width: 1px; height: 20px; background-color: #ddd;"></div>
                  <button class="text-2xl outline-none text-black hover:text-blue-600" type="button" title="撤销" data-action="click->screenshot-editor#redo">
                    <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="currentColor">
                      <path d="M14.5 7H5.83l3.58-3.58L8 2 3.41 6.59 2 8l1.41 1.41L8 14l1.41-1.41L5.83 9h8.67a5.5 5.5 0 0 1 0 11H4v2h10.5a7.5 7.5 0 0 0 0-15z"/>
                    </svg>
                  </button>
                  <button class="text-2xl outline-none text-rose-600 hover:text-blue-600" type="button" title="关闭" data-action="click->screenshot-editor#close">
                    <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="currentColor">
                      <path d="M21.19 4.22l-1.41-1.41L12 10.59 4.22 2.81 2.81 4.22 10.59 12l-7.78 7.78 1.41 1.41L12 13.41l7.78 7.78 1.41-1.41L13.41 12l7.78-7.78z"/>
                    </svg>
                  </button>
                  <button class="text-2xl outline-none text-green-600 hover:text-blue-600" type="button" title="确定" data-action="click->screenshot-editor#confirm">
                    <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="currentColor">
                      <path d="M23.36 5.66l-1.41-1.42L9.26 16.93 2.05 9.72.64 11.13l8.62 8.63 1.42-1.42L23.36 5.66z"/>
                    </svg>
                  </button>
                </div>
              </div>
            </div>
            <div
              class="mt-8"
              data-controller="reference-group"
              data-reference-group-upload-path-value="<%= upload_file_demand_path %>"
              data-manufacturer-feedback-target="referenceContainer"
            >
              <input type="file" class="hidden" multiple data-reference-group-target="fileInput" data-action="change->reference-group#fileInputChange">
              <div class="text-base flex items-center">
                <span>相关参考</span>
                <button class="w-4 h-4 text-neutral-500 hover:text-black transition-all duration-300 ml-2.5 hidden" type="button" data-reference-group-target="uploadButton1Container" data-action="click->reference-group#fileInputClick">
                  <svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" fill="currentColor" class="bi bi-plus-circle" viewBox="0 0 16 16">
                    <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
                    <path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"/>
                  </svg>
                </button>
              </div>
              <div class="mt-4 w-full h-28 border border-neutral-200 rounded text-sm">
                <div class="w-full h-full p-2 text-neutral-300" data-reference-group-target="uploadButton2Container" data-action="click->reference-group#fileInputClick">
                  支持多种上传文件格式：JPG,PNG,PPT,PDF,RAR等（可上传多个）<span class="underline cursor-pointer">点击上传</span>
                </div>
                <div class="w-full h-full p-2.5 overflow-auto hidden" data-reference-group-target="filesContainer">
                </div>
              </div>
            </div>
          <% end %>
        </div>
        <div class="flex justify-center gap-5 p-5 border-t text-neutral-140 border-neutral-235">
          <button class="w-20 h-10 primary-button transition-all duration-300" type="submit" form="feedbackManufacturerForm">提交反馈</button>
          <button class="w-20 h-10 cancel-button transition-all duration-300" type="button" data-action="click->turbo-modal#hide">取消</button>
        </div>
      </div>
    </div>
  </div>
<% end %>
