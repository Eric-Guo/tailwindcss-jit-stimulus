<%= render partial: 'shared/header', locals: {} -%>
<% if @material.level == 3 %>
  <p class="pt-12 text-sm text-gray-500 mx-auto" style="width: 1600px;">首页 > <%= @material.material.material.name %> > <%= @material.material.name %> > <span class="text-black"><%= @material.name %></span></p>
<% else %>
  <p class="pt-12 text-sm text-gray-500 mx-auto" style="width: 1600px;">首页 > <%= @material.material.name %> > <span class="text-black"><%= @material.name %></span></p>
<% end %>
<div class="flex flex-row mx-auto justify-between" style="width: 1600px;">
  <%# 材料菜单 %>
  <section class="material-nav mt-5" data-controller="material-nav">
    <% @tree_materials.each do |item| %>
      <div class="material-nav-item mb-5 <%= @material.id == item[:id] || item[:descendant_ids].include?(@material.id) ? 'active' : '' %>" data-material-nav-target="navItem">
        <div class="material-nav-item-header pb-1" data-action="click->material-nav#navItemClick">
          <div class="material-nav-item-header-title truncate" title="<%= item[:title] %> <%= item[:subtitle] %>">
            <span><%= item[:title] %></span>
            <span>&ensp;<%= item[:subtitle] %></span>
          </div>
          <% if item[:children].present? %>
            <svg xmlns="http://www.w3.org/2000/svg" class="material-nav-item-header-icon h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
            </svg>
          <% end %>
        </div>
        <% if item[:children].present? %>
          <div class="material-nav-item-children flex flex-col px-5 text-lg">
            <% item[:children].each do |child_item| %>
              <div class="relative mt-4 material-nav-item-children-item <%= @material.id == child_item[:id] || child_item[:descendant_ids].include?(@material.id) ? 'active' : '' %>">
                <span class="relative">
                  <span class="truncate" title="<%= child_item[:title] %>"><%= child_item[:title] %></span>
                  <% if child_item[:children].present? %>
                    <svg xmlns="http://www.w3.org/2000/svg" class="-mt-0.5 h-5 w-6 inline" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                    </svg>
                  <% end %>
                  <div class="material-nav-item-children-text-border"></div>
                </span>
                <% if child_item[:children].present? %>
                  <div class="material-nav-item-children-item-children rounded-md shadow">
                    <div class="material-nav-item-children-item-children-list">
                      <% child_item[:children].each do |child2_item| %>
                        <a href="<%= material_path(child2_item[:id]) %>" class="flex-none truncate mb-2 <%= @material.id == child2_item[:id] ? 'active' : '' %>" title="<%= child2_item[:title] %>"><%= child2_item[:title] %></a>
                      <% end %>
                    </div>
                  </div>
                <% end %>
              </div>
            <% end %>
          </div>
        <% end %>
      </div>
    <% end %>
  </section>
  <%# 材料产品详情 %>
  <section class="flex flex-col mt-5" style="width: 1200px;">
    <div class="pb-3 border-b-2 border-gray-100 border-solid">
      <span class="text-2xl font-bold ml-px mr-2 border-b-2 border-gray-900 border-solid border-solid" style="padding-bottom: 0.9rem">材料产品详情</span><span class="text-xl font-light">Material Details</span>
    </div>
    <div class="text-sm text-center text-gray-400 flex content-center justify-start border border-gray-200 border-solid" style="margin-top: 30px;">
      <h2 class="w-24 py-4 bg-gray-100 text-black-6c font-medium text-right pr-6">色系</h2>
      <p class="w-24 py-4">
        <a href="/materials/<%= @material.id %>" class="<%= @color_id.present? ? '' : 'active-pill' %>">
          全部
        </a>
      </p>
      <% @material.parent_color_systems&.each do |color_system| %>
        <p class="w-24 py-4">
          <a href="?color_id=<%= color_system.id -%>" class="<%= @color_id == color_system.id.to_s ? 'active-pill' : '' %>">
            <%= color_system.description -%>
          </a>
        </p>
      <% end %>
    </div>

    <div class="flex flex-row mt-5 justify-between" data-controller="material-color-system" data-material-color-system-min-height-value="121" data-material-color-system-max-height-value="<%= (@projects.size.to_f / 11).ceil * 126 - 5 %>">
      <div class="grid grid-cols-12 gap-2.5 overflow-y-hidden transition-all" style="width: 1166px; height: <%= (@projects.size.to_f / 12).ceil * 126 - 5 %>px" data-material-color-system-target="list">
        <% @projects.each do |project| %>
          <a href="<%= material_path(project.id, request.GET) %>" class="block transition-shadow hover:shadow <%= project.id == @material.id ? 'shadow' : '' %>" style="width: 88px; height: 116px; border: 1px solid #EBEBEB;">
            <img class="mx-auto object-cover" style="width: 88px; height: 88px;" src="<%= get_first_url(project.cover) -%>" alt="">
            <h3 class="text-center text-sm truncate" style="height: 28px; line-height: 28px; margin: 0 10px;" title="<%= project.name %>"><%= project.name -%></h3>
          </a>
        <% end %>
      </div>
      <% if (@projects.size.to_f / 12).ceil > 1 %>
        <div class="relative" style="width: 22px;">
          <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 22 22" class="absolute cursor-pointer transition-transform rotate-180" style="bottom: 47px;" data-action="click->material-color-system#toggle" data-material-color-system-target="toggleBtn">
            <circle cx="11" cy="11" r="11" fill="#f4f4f4" />
            <path fill="gray" fill-rule="evenodd" d="M1776.35,372.889a0.492,0.492,0,0,1-.7,0l-3.54-3.535a0.511,0.511,0,0,1,0-.708,0.5,0.5,0,0,1,.71,0l3.18,3.182,3.18-3.182a0.5,0.5,0,0,1,.71,0,0.511,0.511,0,0,1,0,.708Zm-3.53-1.243,3.18,3.182,3.18-3.182a0.5,0.5,0,0,1,.71,0,0.511,0.511,0,0,1,0,.708l-3.54,3.535a0.492,0.492,0,0,1-.7,0l-3.54-3.535a0.511,0.511,0,0,1,0-.708A0.5,0.5,0,0,1,1772.82,371.646Z" transform="translate(-1765 -362)"/>
          </svg>
        </div>
      <% end %>
    </div>
    <% if @material.level == 3 %>
    <%# 材料名称 %>
    <div class="mt-20 mb-4 border-b-2 border-gray-100 border-solid pb-3">
      <span class="text-2xl font-bold ml-px mr-2 border-b-2 border-gray-900 border-solid" style="padding-bottom: 0.9rem"><%= @material.name %></span><span class="text-xl font-light">（<%= @material.no %>
      ）</span>
    </div>

    <div class="flex gap-20">
      <div>
        <img class="w-72 h-72" src="<%= get_first_url(@material.cover) -%>" alt="">
        <dl class="block w-72 mt-2 text-lg">
          <dt class="my-1 inline-block w-1/2">色系：</dt>
          <dd class="my-1 inline-block text-right" style="width: 48%">
            <% @material.material_product&.color_systems&.each_with_index do |color_system, i| %><%= color_system.description -%>
              <% if i == @material.material_product.color_systems.length %>,
                <% end %>
            <% end %></dd>

          <dt class="my-1 inline-block w-1/2">产地：</dt>
          <dd class="my-1 inline-block text-right" style="width: 48%"><%= @material.material_product&.origin %></dd>

          <dt class="my-1 inline-block w-1/2">价格区间：</dt>
          <dd class="my-1 inline-block text-right" style="width: 48%">
            <%= @material.material_product&.low_price %>-<%= @material.material_product&.high_price %>/㎡
          </dd>

          <dt class="my-1 inline-block w-1/2">是否常用产品：</dt>
          <dd class="my-1 inline-block text-right" style="width: 48%">
            <% if @material.material_product&.is_common == 1 %> 是
            <% end %></dd>
        </dl>
      </div>
      <div>
        <h5 class="text-lg font-medium">表面效果：</h5>
        <div class="grid grid-cols-8 gap-1 my-3">
          <% @material.material_product&.surface_effects&.each do |surface_effect| %>
            <div class="relative">
              <img class="w-full h-full object-fill" src="<%= mat_img_url(surface_effect.path, "static/new_mat_g#{1}.jpg") -%>" alt="">
              <p class="absolute left-1/2 bottom-0 text-white text-center text-sm font-medium whitespace-nowrap" style="transform: translate(-50%, 0);">
                <%= surface_effect.description -%>
              </p>
            </div>
          <% end %>
        </div>
        <h5 class="text-lg font-medium mt-14 mb-3">安装施工要点：</h5>
        <p class="text-sm text-justify"><%= @material.material_product&.points %></p>
        <h5 class="text-lg font-medium mt-14 mb-3">可定制效果：</h5>
        <p class="text-sm text-justify"><%= @material.material_product&.is_customized %></p>
      </div>
    </div>

    <%# 实际应用 材料样品 %>
    <div class="flex justify-between">
      <div class="flex-grow w-0">
        <div class="mt-20 mb-4 border-b-2 border-gray-100 border-solid pb-3 truncate">
          <span class="text-2xl font-bold ml-px mr-2 border-b-2 border-gray-900 border-solid" style="padding-bottom: 0.9rem">实际应用</span><span class="text-xl font-light">Application</span>
        </div>

        <div
          class="bg-gray-100 flex flex-col relative"
          style="height: 493px; padding-left: 60px; padding-right: 60px;"
          data-controller="material-carousel"
          data-material-carousel-enter-class-value="<%= ['-animation-transition-x-full-reverse', 'animation-transition-x-full-reverse'].to_json %>"
          data-material-carousel-leave-class-value="<%= ['animation-transition-x-full', '-animation-transition-x-full'].to_json %>"
          data-material-carousel-duration-value="0.5"
          data-material-carousel-dot-active-class-value="border border-gray-900"
        >
          <% if @material.material_product&.practical_applications.length > 0%>
            <div class="relative overflow-hidden mt-4" style="height: 393px;">
              <% @material&.material_product&.practical_applications&.each_with_index do |practical_application, i| %>
                <div class="w-full h-full absolute top-0 left-0" style="display: <%= i == 0 ? '' : 'none;' %>" data-material-carousel-target="carouselItem">
                  <h5 class="text-lg font-medium text-center mt-4"><%= practical_application&.description -%></h5>
                  <div class="relative mt-3">
                    <div class="relative w-full overflow-hidden" style="height: 353px;">
                      <div class="absolute w-full h-full">
                        <img class="w-full h-full object-cover" src="<%= mat_img_url(practical_application&.path, "") -%>" alt="">
                      </div>
                    </div>
                  </div>
                </div>
              <% end %>
            </div>
            <div class="flex flex-nowrap gap-3 mt-2.5 overflow-x-auto">
              <% @material&.material_product&.practical_applications&.each_with_index do |practical_application, i| %>
                <div
                  class="flex-none cursor-pointer <%= i == 0 ? 'border border-gray-900' : '' %>"
                  style="width: 50px; height: 50px;"
                  data-material-carousel-target="dotItem"
                  data-action="click->material-carousel#toDotIndex"
                >
                  <img class="w-full h-full object-cover" src="<%= mat_img_url(practical_application.path, "") -%>" alt="">
                </div>
              <% end %>
            </div>
            <div class="absolute cursor-pointer" style="left: 21px; top: 216px;" data-action="click->material-carousel#toPrev">
              <svg xmlns="http://www.w3.org/2000/svg" width="18.125" height="32.81" viewBox="0 0 18.125 32.81">
                <path fill="#999" fill-rule="evenodd" d="M599.627,1492.29l-13.54,13.54,13.674,13.68a1.641,1.641,0,1,1-2.321,2.32l-14.846-14.85a1.647,1.647,0,0,1-.011-2.33l14.7-14.7A1.656,1.656,0,0,1,599.627,1492.29Z" transform="translate(-582.125 -1489.5)"/>
              </svg>
            </div>
            <div class="absolute cursor-pointer" style="right: 21px; top: 216px;" data-action="click->material-carousel#toNext">
              <svg xmlns="http://www.w3.org/2000/svg" width="18" height="33.03" viewBox="0 0 18 33.03">
                <path fill="#999" fill-rule="evenodd" class="cls-1" d="M599.534,1558.58l-14.743,14.93a1.62,1.62,0,0,1-2.317.01,1.667,1.667,0,0,1,.012-2.34l13.579-13.75-13.446-13.62a1.678,1.678,0,0,1,.011-2.35,1.628,1.628,0,0,1,2.316-.01l14.6,14.79A1.666,1.666,0,0,1,599.534,1558.58Z" transform="translate(-582.031 -1540.97)"/>
              </svg>
            </div>
          <% end %>
        </div>
      </div>
      <div class="flex-grow w-0 ml-5">
        <div class="mt-20 mb-4 border-b-2 border-gray-100 border-solid pb-3 truncate">
          <span class="text-2xl font-bold ml-px mr-2 border-b-2 border-gray-900 border-solid" style="padding-bottom: 0.9rem">材料样品</span><span class="text-xl font-light">Samples</span>
        </div>

        <div class="flex flex-col bg-gray-100" style="height: 493px;">
          <h5 class="mt-4 text-lg font-medium text-center">实体材料库库存信息</h5>
          <div class="mx-3 mt-3 overflow-auto" style="height: 353px;">
            <table class="min-w-full border-collapse">
              <thead>
                <tr class="sticky bg-gray-50" style="top: -1px; left: 0;">
                  <th scope="col" class="px-1 py-2 border whitespace-nowrap text-center text-sm text-gray-900">
                    样品编号
                  </th>
                  <th scope="col" class="px-1 py-2 border whitespace-nowrap text-center text-sm text-gray-900">
                    色系
                  </th>
                  <th scope="col" class="px-1 py-2 border whitespace-nowrap text-center text-sm text-gray-900">
                    样品规格、型号
                  </th>
                  <th scope="col" class="px-1 py-2 border whitespace-nowrap text-center text-sm text-gray-900">
                    表面工艺
                  </th>
                  <th scope="col" class="px-1 py-2 border whitespace-nowrap text-center text-sm text-gray-900">
                    剩余库存
                  </th>
                  <th scope="col" class="px-1 py-2 border whitespace-nowrap text-center text-sm text-gray-900">
                    存放位置
                  </th>
                  <th scope="col" class="px-1 py-2 border whitespace-nowrap text-center text-sm text-gray-900">
                    供应商
                  </th>
                </tr>
              </thead>
              <tbody>
                <% @samples&.each do |sample| %>
                  <tr class="bg-white">
                    <td class="px-1 2xl:px-2 py-2 text-center border whitespace-nowrap text-xs font-medium">
                      <a class="underline" href="<%= sample_path(sample.no) %>"><%= sample.no -%></a>
                    </td>
                    <td class="px-1 2xl:px-2 py-2 text-center border whitespace-nowrap text-xs">
                      <% sample&.color_systems&.each_with_index do |color_system, i| %>
                        <%= color_system.description -%>
                        <% if i == sample.color_systems.length %>,
                        <% end %>
                      <% end %>
                    </td>
                    <td class="px-1 2xl:px-2 py-2 text-center border whitespace-nowrap text-xs">
                      <%= sample.spec_model -%>
                    </td>
                    <td class="px-1 2xl:px-2 py-2 text-center border whitespace-nowrap text-xs">
                      <% sample&.surface_effects&.each_with_index do |surface_effect, i| %><%= surface_effect.description -%>
                        <% if i == sample.surface_effects.length %>,
                        <% end %>
                      <% end %>
                    </td>
                    <td class="px-1 2xl:px-2 py-2 text-center border whitespace-nowrap text-xs">
                        未知
                    </td>
                    <td class="px-1 2xl:px-2 py-2 text-center border whitespace-nowrap text-xs">
                      <%= sample.position %>
                    </td>
                    <td class="px-1 2xl:px-2 py-2 text-center border whitespace-nowrap text-xs">
                      <%= sample.manufacturer&.name %>
                    </td>
                  </tr>
                <% end %>
              </tbody>
            </table>
          </div>
          <p class="mx-4 mt-4 text-sm">实体材料库地址：上海市徐汇区漕河泾科汇大厦11F</p>
        </div>
      </div>
    </div>

    <%# 产品案例 %>
    <div class="mt-20 mb-4 border-b-2 border-gray-100 border-solid pb-3">
      <span class="text-2xl font-bold ml-px mr-2 border-b-2 border-gray-900 border-solid" style="padding-bottom: 0.9rem">产品案例</span><span class="text-xl font-light">Projects</span>
    </div>

    <div class="grid grid-cols-3 gap-1.5">
      <% @cases&.each do |project_case| %>
      <div class="bg-cover bg-center bg-no-repeat flex flex-col" style="height: 296px; background-image: url('<%= get_first_url(project_case.live_photos) %>');">
        <div class="flex flex-row p-2.5 justify-end">
          <div class="bg-gray-500 bg-opacity-80 text-white text-sm px-2">荔枝面黄金麻</div>
        </div>
        <div class="mt-auto h-20 pl-4 pr-5 pb-2.5 flex flex-row items-end black-mask">
          <div class="text-white flex-1 w-0">
            <div class="truncate" title="<%= project_case.project_name -%>/<%= project_case.project_location -%>">
              <span class="text-lg"><%= project_case.project_name -%>/</span>
              <span class="text-sm"> <%= project_case.project_location -%></span>
            </div>
            <div class="text-sm truncate"></div>
          </div>
          <div class="text-white text-sm whitespace-nowrap flex-none ml-12">
            <%= project_case.is_th == 1 ? '内部项目' : '外部项目' %>
          </div>
        </div>
      </div>
        <% end %>
    </div>

    <%# 构造做法 %>
    <div class="mt-20 mb-4 border-b-2 border-gray-100 border-solid pb-3">
      <span class="text-2xl font-bold ml-px mr-2 border-b-2 border-gray-900 border-solid" style="padding-bottom: 0.9rem">构造做法</span><span class="text-xl font-light">Construction</span>
    </div>

    <div class="m-4 grid grid-cols-3 gap-1.5">
      <% if @material.material_product&.practice_details.present? %>
        <% JSON.parse(@material.material_product.practice_details)&.each_with_index do |practice_detail, i| %>
        <div class="<% if i == 0  %>col-span-2 row-span-3<% end %> relative">
          <img class="w-full h-full" src="<%= mat_img_url(practice_detail["url"], "") -%>" alt="">
          <div class="black-mask absolute left-0 bottom-0 w-full p-2 text-white text-left">
            <p class="text-lg"><%= practice_detail["name"] -%></p>
          </div>
        </div>
        <% end %>
      <% end %>
    </div>

    <%# 源文件 %>
    <div class="mt-20 mb-4 border-b-2 border-gray-100 border-solid pb-3">
      <span class="text-2xl font-bold ml-px mr-2 border-b-2 border-gray-900 border-solid" style="padding-bottom: 0.9rem">源文件</span><span class="text-xl font-light">Files</span>
    </div>

    <div class="my-2 grid grid-cols-6 gap-1.5">
      <% if @material.material_product&.source_file.present? %>
        <% JSON.parse(@material.material_product.source_file)&.each do |source_file| %>
          <div class="flex flex-row p-4 shadow-tw-dark font-medium bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500" title="<%= source_file["name"] %>">
            <div class="flex-1 truncate w-0 select-none"><%= source_file["name"] %></div>
            <a class="ml-4" href="<%= mat_img_url(source_file["url"], "") -%>" download="<%= source_file["name"] %>" target="_blank">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 float-right" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M9 19l3 3m0 0l3-3m-3 3V10"/>
              </svg>
            </a>
          </div>
        <% end %>
      <% end %>
    </div>

    <%# 材质贴图 %>
    <div class="mt-20 mb-4 border-b-2 border-gray-100 border-solid pb-3">
      <span class="text-2xl font-bold ml-px mr-2 border-b-2 border-gray-900 border-solid" style="padding-bottom: 0.9rem">材质贴图</span><span class="text-xl font-light">Texture</span>
    </div>
    <div class="my-6 grid grid-cols-6 gap-1.5">
      <% if @material.material_product&.su_picture.present? %>
        <% JSON.parse(@material.material_product.su_picture)&.each do |su_picture| %>
          <img class="w-full object-fill" src="<%= mat_img_url(su_picture["url"], "2") -%>" alt="">
        <% end %>
      <% end %>
    </div>

    <%# 厂家信息 %>
    <div class="mt-20 mb-4 border-b-2 border-gray-100 border-solid pb-3">
      <span class="text-2xl font-bold ml-px mr-2 border-b-2 border-gray-900 border-solid" style="padding-bottom: 0.9rem">厂家信息</span><span class="text-xl font-light">Manufacturer</span>
    </div>
    <div class="mt-6 mb-16 grid grid-cols-3 gap-4">
      <%= render partial: 'shared/manufacturers', locals: {manufacturers:@material.manufacturers} -%>
    </div>
    <% end %>
  </section>
</div>
